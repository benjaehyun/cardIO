<%- include('../partials/header') %>

<!-- <%=deck.title%>
<h3> <img src="<%=deck.userAvatar %>" alt="avatar" referrerpolicy="no-referrer"> <%= deck.userName %> </h3> -->
<!-- add a link to the user page when its added -->
<h1><%= deck.title%> </h1>
<h3>By: <%= deck.userName %></h3>
<img alt="avatar" src="<%= deck.userAvatar %>" referrerpolicy="no-referrer" >
<h3>notes: <%= deck.notes%> </h3>



<% if (user?._id.equals(deck.user)) { %>
    <a href="/decks/<%= deck._id %>/edit">Edit Details</a>
    <div id="delete-deck">
        <form action="/decks/<%=deck._id%>?_method=DELETE" method="POST">
            <button type="submit">DELETE DECK</button>
        </form>
    </div>
    <% } %>

<!-- <div id="delete-deck">
    <% if (user?._id.equals(deck.user)) { %>
        <form action="/decks/<%=deck._id%>?_method=DELETE" method="POST">
            <button type="submit">DELETE DECK</button>
        </form>
    <% } %> -->
</div>
<% deck.cards.forEach(function (c) { %> 
    <div id="card-pair">
        <div id="deck-card-front">
            <%= c.front %>
        </div>
        <div id="deck-card-back">
            <%= c.back %>
        </div>
        <div>
            <a href="/decks/<%=deck._id%>/cards/<%=c._id%>/edit"> Edit Card </a>
        </div>
    </div>
    <br> <br>
<% }) %>

<% if (user?._id.equals(deck.user)) { %>
    <a href='/decks/<%=deck._id%>/cards/new'>Add Cards</a>
    
    <% } %>



<br><br><h2>Comments</h2>
<form id="add-deck-comment-form" method="POST"
    action="/decks/<%= deck._id %>/comments">
    <label>Comment:</label>
    <textarea name="content"></textarea>
    <input type="submit" value="Add Comment">
</form>

<% if (deck.comments.length) { %> 
<div id="deck-comment">
        <% deck.comments.forEach(function(com) { %>
            <h4> <img src="<%=com.userAvatar %>" alt="avatar" referrerpolicy="no-referrer"> <%= com.userName %> </h4>
            <p> <%= com.content%></p>
            <%= com.createdAt%> 
            <div id="delete-card-comment">
                <% if (user?._id.equals(com.user)) { %>
                    <form action="/decks/<%=deck._id%>/comments/<%=com._id%>?_method=DELETE" method="POST">
                        <button type="submit">DELETE COMMENT</button>
                    </form>
                <% } %>
            </div>
        <% }) %>
<% } else { %>
    <h4>No Comments Yet</h4>
<% } %>
</div>
<!-- be sure to add a way to create comments and to edit/delete comments -->

<%- include('../partials/footer') %>